globals:
  - id: user_is_interacting
    type: bool
    initial_value: "false"
    restore_value: no

esphome:
  on_boot:
    - priority: 250
      then:
        # Using ESPhome packages will cause the settings page to be the first one, lvgl.page.next will make it look like the last one again.
        - lvgl.page.next:
            animation: NONE
    - priority: 100
      then:
        # Apply i18n to the dropdown.
        - lambda: tr_select(id(lvgl_display_backlight_timeout));

lvgl:
  pages:
    - id: settings
      skip: true
      bg_color: 0x0d0d0d
      bg_opa: COVER
      widgets:
        - !include
            file: templates/page_title_with_back_button_tr.yaml
            vars:
              page_id: settings
              title_key: settings.settings
              previous_page_id: ${first_page_id}
              previous_page_index: "0"
        - obj:
            styles: content_container
            pad_left: 0
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: LV_FLEX_ALIGN_START
              flex_align_cross: LV_FLEX_ALIGN_START
              flex_align_track: LV_FLEX_ALIGN_CENTER
            widgets:
              - obj:
                  styles: ["settings_item", "settings_display_brightness_height"]
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  layout:
                    type: FLEX
                    flex_flow: COLUMN
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: LV_FLEX_ALIGN_START
                    flex_align_track: LV_FLEX_ALIGN_START
                    pad_row: 0
                  widgets:
                    - label:
                        id: lbl_display_brightness
                        pad_left: 30
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_display_brightness), "settings.display_brightness");
                    - obj:
                        styles: settings_item_internal_width
                        bg_opa: TRANSP
                        height: SIZE_CONTENT
                        pad_all: 0
                        pad_top: 5
                        pad_bottom: 15
                        layout:
                          type: FLEX
                          flex_flow: ROW
                          flex_align_main: SPACE_EVENLY
                          flex_align_cross: CENTER
                          flex_align_track: CENTER
                          pad_row: 0
                        widgets:
                          - label:
                              text_color: 0xffffff
                              text_font: brightness_small
                              text: "\U000F05A8"
                          - slider:
                              id: lvgl_indicator_lcd_brightness_slider
                              styles: settings_display_brightness_slider
                              value: 100
                              min_value: 5
                              max_value: 100
                              bg_color: 0x525a46
                              indicator:
                                bg_color: 0x92ae67
                              knob:
                                bg_color: 0xFFFFFF
                              on_press:
                                then:
                                  - globals.set:
                                      id: user_is_interacting
                                      value: 'true'
                              on_release:
                                then:
                                  - globals.set:
                                      id: user_is_interacting
                                      value: 'false'
                              on_value:
                                if:
                                  condition:
                                    lambda: |-
                                      return id(user_is_interacting);
                                  then:
                                    - light.control:
                                        id: display_backlight
                                        state: on
                                        brightness: !lambda 'return x / 100.0;'
                          - label:
                              text_color: 0xffffff
                              text_font: brightness_big
                              text: "\U000F05A8"
              - obj:
                  styles: settings_item
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  pad_left: 30
                  pad_right: 30
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_BETWEEN
                    flex_align_cross: CENTER
                    flex_align_track: CENTER
                  widgets:
                    - label:
                        id: lbl_turn_off_screen_after
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_turn_off_screen_after), "settings.turn_off_screen_after");
                    - dropdown:
                        id: lvgl_display_backlight_timeout
                        styles: settings_dropdown
                        bg_color: 0x181818
                        text_color: 0xffffff
                        border_width: 0
                        text_font: libreFranklin18
                        dir: TOP
                        dropdown_list:
                          bg_color: 0x292929
                          text_color: 0xffffff
                          text_font: libreFranklin18
                          border_width: 1
                          border_color: 0x999999
                          selected:
                            checked:
                              bg_color: 0x92ae67
                        options:  # These are updated to localized values in esphome.yaml on_boot
                          - "settings.never"
                          - "settings.minute1"
                          - "settings.minute5"
                          - "settings.minute15"
              - obj:
                  styles: settings_item
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  pad_left: 30
                  pad_right: 30
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_BETWEEN
                    flex_align_cross: CENTER
                    flex_align_track: CENTER
                  widgets:
                    - label:
                        id: lbl_language
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_language), "settings.language");
                    - dropdown:
                        id: lvgl_language_dropdown
                        styles: settings_dropdown
                        bg_color: 0x181818
                        text_color: 0xffffff
                        border_width: 0
                        text_font: libreFranklin18
                        dir: BOTTOM
                        dropdown_list:
                          bg_color: 0x292929
                          text_color: 0xffffff
                          text_font: libreFranklin18
                          border_width: 1
                          border_color: 0x999999
                          selected:
                            checked:
                              bg_color: 0x92ae67
                        options:
                          - "en"
                          - "de"
                          - "ru"
              - obj:
                  styles: settings_item
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  pad_left: 30
                  pad_right: 30
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_BETWEEN
                    flex_align_cross: CENTER
                    flex_align_track: CENTER
                  widgets:
                    - label:
                        id: lbl_use_24h_clock
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_use_24h_clock), "settings.use_24h_clock");
                    - switch:
                        id: lvgl_24h_clock_switch
                        height: 40
                        width: 85
                        bg_color: 0xdddddd
              - obj:
                  styles: settings_item
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  pad_left: 30
                  pad_right: 30
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_BETWEEN
                    flex_align_cross: CENTER
                    flex_align_track: CENTER
                  widgets:
                    - label:
                        id: lbl_show_title_bar
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_show_title_bar), "settings.show_title_bar");
                    - switch:
                        id: lvgl_show_title_bar_switch
                        height: 40
                        width: 85
                        bg_color: 0xdddddd
              - obj:
                  styles: settings_item
                  bg_color: 0x202020
                  bg_opa: COVER
                  pad_all: 0
                  pad_left: 30
                  pad_right: 30
                  layout:
                    type: FLEX
                    flex_flow: ROW
                    flex_align_main: SPACE_BETWEEN
                    flex_align_cross: CENTER
                    flex_align_track: CENTER
                  widgets:
                    - label:
                        id: lbl_auto_cycling_enabled
                        text_color: 0xffffff
                        text_font: libreFranklin18
                        text: !lambda return tr_label(id(lbl_auto_cycling_enabled), "settings.auto_cycle_through_screens");
                    - switch:
                        id: lvgl_auto_cycling_enabled_switch
                        height: 40
                        width: 85
                        bg_color: 0xdddddd